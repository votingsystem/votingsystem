<!DOCTYPE html>
<html>
<head>
    <script src="./js/ckeditor.js" type="text/javascript" ></script>
    <script type="text/javascript">
        var SC_PAUSED = 10
        var SC_OK     = 200
        var SC_ERROR  = 500
        var isEditorLoaded = false
        var editorContent = ' '
        var refreshIntervalId, editor

        var editorConfig = {toolbar: [[ 'Bold', 'Italic', '-', 'NumberedList', 'BulletedList'],
         [ 'FontSize', 'TextColor', 'BGColor' ]]}


    // The instanceReady event is fired, when an instance of CKEditor has finished its initialization.
        CKEDITOR.on( 'instanceReady', function( ev ) {
            isEditorLoaded = true;
            if(editorContent != null) {
                setEditorContent(editorContent)
                editorContent = null;
            }
        });

        function setEditorContent(value) {
            if(!isEditorLoaded) editorContent = value
            else editor.insertHtml(value);
        }

        function submitForm() {
            if(editor.getData().trim().length == 0) {
                 saveForm(SC_ERROR)
            } else {
                clearInterval(refreshIntervalId);
                saveForm(SC_OK)
            }
        }

        function saveForm(statusCode) {
            if(isEditorLoaded) {
                editorContent = editor.getData().trim()
                var webAppMessage = {statusCode:statusCode, message:editorContent}
                var message = JSON.stringify(webAppMessage)
                androidClientTool.setJSONMessageToSignatureClient(message);
                return false
            }
        }

        window.onload = function() {
            createEditor();
        };

        function createEditor(value) {
			if (editor) return;
			if(value != null) editorContent = value
			document.getElementById('editorContents').innerHTML = ''
			editor = CKEDITOR.appendTo('editorDiv', editorConfig);
            editor.focus();
            refreshIntervalId = setInterval(function(){saveForm(SC_PAUSED)},1000);
		}

		function removeEditor() {
			if (!editor) return;
			saveForm(SC_PAUSED)
			document.getElementById('editorContents').innerHTML = html = editorContent;
			document.getElementById('editorContents').style.display = '';
			editor.destroy();
			editor = null;
            clearInterval(refreshIntervalId);
            isEditorLoaded = false;
		}

    </script>
</head>
<body>
    <div style="position:relative; width:100%;margin:0 0 0 0;">
        <div id='editorDiv' style="height:100%; width:100%;"></div>
        <div id="editorContents" style="display: none"></div>
    </div>
</body>
</html>